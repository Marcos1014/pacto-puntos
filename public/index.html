<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>üß≠ Pacto de Puntos ‚Äî Viaje al Sur</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #0f1923;
  --card: #1a2a3a;
  --accent: #4ecdc4;
  --accent2: #ff6b6b;
  --gold: #ffd93d;
  --text: #e8e8e8;
  --muted: #8899aa;
  --success: #2ecc71;
  --danger: #e74c3c;
}
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  padding-bottom: 80px;
}

/* Login */
.login-screen {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  min-height: 100vh; padding: 20px; text-align: center;
}
.login-screen h1 { font-size: 2em; margin-bottom: 8px; }
.login-screen .subtitle { color: var(--muted); margin-bottom: 40px; font-size: 0.95em; }
.login-btn {
  display: block; width: 200px; padding: 16px; margin: 10px auto;
  border: 2px solid var(--accent); background: transparent; color: var(--accent);
  border-radius: 12px; font-size: 1.1em; cursor: pointer; transition: all 0.2s;
}
.login-btn:active { background: var(--accent); color: var(--bg); }

/* Header */
.header {
  background: linear-gradient(135deg, #1a2a3a, #2a3a4a);
  padding: 16px 20px; display: flex; justify-content: space-between; align-items: center;
  border-bottom: 2px solid var(--accent);
}
.header .user-info { font-size: 1.1em; font-weight: 600; }
.header .logout { background: none; border: none; color: var(--muted); cursor: pointer; font-size: 0.9em; }

/* Score cards */
.scores {
  display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
  padding: 16px 20px;
}
.score-card {
  background: var(--card); border-radius: 14px; padding: 16px; text-align: center;
}
.score-card.mine { border: 2px solid var(--accent); }
.score-card.other { border: 2px solid var(--accent2); }
.score-card .label { font-size: 0.8em; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }
.score-card .pts { font-size: 2.2em; font-weight: 700; margin: 4px 0; }
.score-card.mine .pts { color: var(--accent); }
.score-card.other .pts { color: var(--accent2); }

/* Review banner */
.review-banner {
  background: linear-gradient(135deg, #2ecc71, #27ae60);
  margin: 0 20px; padding: 12px 16px; border-radius: 10px;
  text-align: center; font-weight: 600; display: none;
}
.review-banner.active { display: block; }

/* Tabs */
.tabs {
  display: flex; position: fixed; bottom: 0; left: 0; right: 0;
  background: #1a2a3a; border-top: 1px solid #2a3a4a; z-index: 100;
}
.tab {
  flex: 1; padding: 12px 0; text-align: center; cursor: pointer;
  font-size: 0.75em; color: var(--muted); transition: color 0.2s;
}
.tab.active { color: var(--accent); }
.tab .icon { font-size: 1.5em; display: block; margin-bottom: 2px; }

/* Sections */
.section { display: none; padding: 16px 20px; }
.section.active { display: block; }

/* Gesto list */
.gesto-item, .canje-item, .review-item {
  background: var(--card); border-radius: 12px; padding: 14px 16px;
  margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;
  cursor: pointer; transition: transform 0.1s;
}
.gesto-item:active, .canje-item:active { transform: scale(0.98); }
.gesto-item .name, .canje-item .name, .review-item .name { font-size: 0.95em; flex: 1; }
.gesto-item .pts-badge, .canje-item .cost-badge {
  background: var(--accent); color: var(--bg); border-radius: 20px;
  padding: 4px 12px; font-weight: 700; font-size: 0.9em; min-width: 40px; text-align: center;
}
.canje-item .cost-badge { background: var(--gold); }

/* Review actions */
.review-item { flex-wrap: wrap; }
.review-item .meta { font-size: 0.8em; color: var(--muted); width: 100%; margin-top: 6px; }
.review-actions { display: flex; gap: 8px; margin-top: 8px; width: 100%; }
.review-actions button {
  flex: 1; padding: 10px; border: none; border-radius: 8px;
  font-weight: 600; cursor: pointer; font-size: 0.9em;
}
.btn-approve { background: var(--success); color: white; }
.btn-reject { background: var(--danger); color: white; }

/* Pending list */
.pending-item {
  background: var(--card); border-radius: 10px; padding: 12px 16px; margin-bottom: 8px;
  display: flex; justify-content: space-between; align-items: center;
}
.pending-item .status { font-size: 0.8em; padding: 3px 8px; border-radius: 6px; }
.status-pending { background: #f39c12; color: #000; }
.status-approved { background: var(--success); color: white; }
.status-disputed { background: var(--danger); color: white; }
.status-rejected { background: #7f8c8d; color: white; }

.section-title { font-size: 1.1em; font-weight: 600; margin-bottom: 14px; color: var(--gold); }
.empty-msg { text-align: center; color: var(--muted); padding: 30px; font-style: italic; }

/* Toast */
.toast {
  position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
  background: var(--success); color: white; padding: 12px 24px; border-radius: 10px;
  font-weight: 600; z-index: 200; opacity: 0; transition: opacity 0.3s;
}
.toast.show { opacity: 1; }

/* Reglamento */
.reglamento { padding-bottom: 20px; }
.pacto-intro {
  background: var(--card); border-radius: 12px; padding: 16px;
  margin-bottom: 16px; color: var(--muted); line-height: 1.6; font-size: 0.9em;
}
.pacto-chapter {
  background: var(--card); border-radius: 12px; margin-bottom: 10px;
  overflow: hidden; border: 1px solid transparent; transition: border-color 0.2s;
}
.pacto-chapter.open { border-color: var(--accent); }
.chapter-title {
  padding: 14px 16px; cursor: pointer; display: flex;
  justify-content: space-between; align-items: center;
  font-weight: 600; font-size: 0.95em;
  transition: background 0.2s;
}
.chapter-title:active { background: rgba(78, 205, 196, 0.1); }
.chevron {
  font-size: 0.7em; color: var(--muted);
  transition: transform 0.2s;
}
.pacto-chapter.open .chevron { transform: rotate(180deg); }
.chapter-body {
  max-height: 0; overflow: hidden; transition: max-height 0.3s ease;
}
.pacto-chapter.open .chapter-body { max-height: 2000px; }
.articulo {
  padding: 10px 16px; font-size: 0.85em; line-height: 1.6;
  border-top: 1px solid rgba(255,255,255,0.05);
  color: var(--text);
}
.articulo strong { color: var(--accent); }
</style>
</head>
<body>

<!-- Login -->
<div id="loginScreen" class="login-screen">
  <div style="font-size:3em;margin-bottom:16px">üß≠</div>
  <h1>Pacto de Puntos</h1>
  <p class="subtitle">Viaje al Sur ‚Äî Marcos & Sof√≠a</p>
  <button class="login-btn" onclick="login('marcos')">üèîÔ∏è Marcos</button>
  <button class="login-btn" onclick="login('sofi')">üå∏ Sof√≠a</button>
</div>

<!-- App -->
<div id="app" style="display:none">
  <div class="header">
    <span class="user-info" id="userInfo"></span>
    <button class="logout" onclick="logout()">Salir</button>
  </div>
  
  <div class="scores">
    <div class="score-card mine">
      <div class="label">Mis puntos</div>
      <div class="pts" id="myPts">0</div>
    </div>
    <div class="score-card other">
      <div class="label" id="otherLabel">Otro</div>
      <div class="pts" id="otherPts">0</div>
    </div>
  </div>

  <div class="review-banner" id="reviewBanner">
    ‚ú® ¬°Momento de revisi√≥n! Revis√° los gestos pendientes
  </div>

  <!-- Sections -->
  <div id="secGestos" class="section active">
    <div class="section-title">üìù Cargar gesto</div>
    <div id="gestosList"></div>
    <div class="section-title" style="margin-top:20px">‚è≥ Mis gestos pendientes</div>
    <div id="myPendingList"></div>
  </div>

  <div id="secReview" class="section">
    <div class="section-title">üîç Revisar gestos</div>
    <div id="reviewList"></div>
  </div>

  <div id="secCanjes" class="section">
    <div class="section-title">üéÅ Canjear puntos</div>
    <div id="canjesList"></div>
    <div class="section-title" style="margin-top:20px">üìã Canjes pendientes de aprobaci√≥n</div>
    <div id="pendingCanjesList"></div>
    <div class="section-title" style="margin-top:20px">üìú Mis canjes</div>
    <div id="myCanjesList"></div>
  </div>

  <div id="secHistory" class="section">
    <div class="section-title">üìä Historial</div>
    <div id="historyList"></div>
  </div>

  <div id="secReglas" class="section">
    <div class="section-title">üìú Pacto de Convivencia de Viaje</div>
    <div class="reglamento">
      <div class="pacto-intro">
        <em>Considerando que ambas partes se quieren pero tambi√©n se sacan de quicio, y que 14 d√≠as de convivencia 24/7 en espacios reducidos pueden destruir lo que a√±os de relaci√≥n construyeron, se establece el siguiente pacto de mutuo respeto y supervivencia.</em>
      </div>

      <div class="pacto-chapter">
        <div class="chapter-title" onclick="this.parentElement.classList.toggle('open')">
          <span>Cap. 1 ‚Äî Tiempos y Rutinas</span>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="chapter-body">
          <div class="articulo"><strong>Art. 1 ‚Äî Hora de salida.</strong> Se acordar√° la noche anterior a qu√© hora se sale. Una vez acordada, hay <strong>15 min de tolerancia</strong>. Pasados esos 15 min, la parte que est√© lista puede manifestar disgusto leg√≠timamente.</div>
          <div class="articulo"><strong>Art. 2 ‚Äî Tiempo de preparaci√≥n.</strong> Cada parte conoce cu√°nto tarda. Es responsabilidad de cada uno calcular su tiempo y levantarse acorde. No se aceptan "5 minutitos m√°s" reiterados.</div>
          <div class="articulo"><strong>Art. 3 ‚Äî Descanso vs. Actividad.</strong> Si un d√≠a uno quiere explorar y el otro quedarse, <strong>est√° permitido separarse por unas horas</strong>. No es abandono, es salud mental.</div>
          <div class="articulo"><strong>Art. 4 ‚Äî Siesta sagrada.</strong> Si una parte necesita descansar despu√©s del almuerzo, la otra lo respeta. M√°ximo 1 hora. No se juzga.</div>
          <div class="articulo"><strong>Art. 5 ‚Äî Hora de dormir.</strong> Si uno quiere dormir y el otro no tiene sue√±o, el que est√° despierto baja el volumen/brillo y respeta el descanso del otro.</div>
        </div>
      </div>

      <div class="pacto-chapter">
        <div class="chapter-title" onclick="this.parentElement.classList.toggle('open')">
          <span>Cap. 2 ‚Äî Comunicaci√≥n</span>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="chapter-body">
          <div class="articulo"><strong>Art. 6 ‚Äî Regla de los 10 segundos.</strong> Antes de decir algo con bronca, contar hasta 10. Si despu√©s sigue pareciendo necesario, decirlo pero <strong>sin levantar la voz</strong>.</div>
          <div class="articulo"><strong>Art. 7 ‚Äî Prohibido acumular.</strong> Si algo molesta, se dice <strong>en el momento</strong> con respeto. Prohibido guardarse 5 quejas y largarlas juntas.</div>
          <div class="articulo"><strong>Art. 8 ‚Äî Frase de emergencia: "Necesito 10 minutos".</strong> Cuando alguien la dice, la otra parte respeta el espacio. Sin preguntas. 10 min de silencio y despu√©s se habla.</div>
          <div class="articulo"><strong>Art. 9 ‚Äî No al sarcasmo destructivo.</strong> El humor est√° bien. Las indirectas pasivo-agresivas no.</div>
          <div class="articulo"><strong>Art. 10 ‚Äî Prohibido invocar peleas pasadas.</strong> Este viaje empieza de cero.</div>
        </div>
      </div>

      <div class="pacto-chapter">
        <div class="chapter-title" onclick="this.parentElement.classList.toggle('open')">
          <span>Cap. 3 ‚Äî Plata</span>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="chapter-body">
          <div class="articulo"><strong>Art. 11 ‚Äî M√©todo de gastos.</strong> Se elige UNO y se respeta: cada uno paga lo suyo / fondo com√∫n / uno paga y se divide / se van alternando.</div>
          <div class="articulo"><strong>Art. 12 ‚Äî Gastos grandes.</strong> Cualquier gasto individual grande se consulta antes. Sin excepciones.</div>
          <div class="articulo"><strong>Art. 13 ‚Äî No juzgar gastos del otro.</strong> Si ella/√©l quiere comprarse algo con su plata, no opinar salvo que pida opini√≥n.</div>
          <div class="articulo"><strong>Art. 14 ‚Äî Registro.</strong> Llevar una nota compartida (Splitwise, etc.) para evitar el "yo pagu√© m√°s".</div>
        </div>
      </div>

      <div class="pacto-chapter">
        <div class="chapter-title" onclick="this.parentElement.classList.toggle('open')">
          <span>Cap. 4 ‚Äî Espacio Personal</span>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="chapter-body">
          <div class="articulo"><strong>Art. 15 ‚Äî Derecho al silencio.</strong> Estar callado no significa estar enojado. Se respeta sin interrogatorio.</div>
          <div class="articulo"><strong>Art. 16 ‚Äî Celular.</strong> Cada uno usa su celular sin comentarios. PERO: durante comidas juntos, se guardan (salvo para fotos de la comida).</div>
          <div class="articulo"><strong>Art. 17 ‚Äî Espacio en la habitaci√≥n.</strong> Cada uno tiene su lado de la cama y su zona de valija. No invadir.</div>
          <div class="articulo"><strong>Art. 18 ‚Äî Ba√±o.</strong> Se acuerda un orden. El que tarda m√°s va primero o se levanta antes. No se vale monopolizar el ba√±o.</div>
          <div class="articulo"><strong>Art. 19 ‚Äî Tiempo a solas.</strong> Cada parte tiene derecho a pedir <strong>m√≠nimo 1 hora por d√≠a</strong> para estar sola. No es negociable.</div>
        </div>
      </div>

      <div class="pacto-chapter">
        <div class="chapter-title" onclick="this.parentElement.classList.toggle('open')">
          <span>Cap. 5 ‚Äî Decisiones</span>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="chapter-body">
          <div class="articulo"><strong>Art. 20 ‚Äî D√≥nde comer.</strong> Se alterna: un d√≠a elige uno, al siguiente el otro. La decisi√≥n final es del que tiene el "turno".</div>
          <div class="articulo"><strong>Art. 21 ‚Äî Qu√© hacer.</strong> Se arma la noche anterior un plan tentativo. Ambas partes proponen. Se negocia.</div>
          <div class="articulo"><strong>Art. 22 ‚Äî Cambio de planes.</strong> Si el plan cambia sobre la marcha, se comunica sin drama.</div>
          <div class="articulo"><strong>Art. 23 ‚Äî Fotos.</strong> Prohibido obligar al otro a posar 47 veces. <strong>M√°ximo 3 intentos por foto.</strong></div>
        </div>
      </div>

      <div class="pacto-chapter">
        <div class="chapter-title" onclick="this.parentElement.classList.toggle('open')">
          <span>Cap. 6 ‚Äî Conflictos</span>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="chapter-body">
          <div class="articulo"><strong>Art. 24 ‚Äî Escala de conflicto.</strong><br>
            1. <strong>Molestia menor</strong> ‚Üí Se dice una vez, se ajusta, se sigue.<br>
            2. <strong>Conflicto medio</strong> ‚Üí Frase de emergencia (Art. 8), se habla despu√©s.<br>
            3. <strong>Pelea grande</strong> ‚Üí Se separan m√≠nimo 30 min. Se juntan cuando est√©n calmados.</div>
          <div class="articulo"><strong>Art. 25 ‚Äî Prohibido arruinar el d√≠a.</strong> Si hubo pelea a la ma√±ana, se resuelve o se pausa, pero <strong>no se arrastra todo el d√≠a</strong>.</div>
          <div class="articulo"><strong>Art. 26 ‚Äî No involucrar terceros.</strong> Los problemas se resuelven entre los dos. No se llama a mam√°/amigos para que tomen partido en el momento.</div>
          <div class="articulo"><strong>Art. 27 ‚Äî Perd√≥n genuino.</strong> Si alguien pide perd√≥n y el otro acepta, <strong>SE TERMIN√ì</strong>. No se puede aceptar un perd√≥n y seguir con cara de culo 3 horas.</div>
        </div>
      </div>

      <div class="pacto-chapter">
        <div class="chapter-title" onclick="this.parentElement.classList.toggle('open')">
          <span>Cap. 7 ‚Äî Log√≠stica</span>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="chapter-body">
          <div class="articulo"><strong>Art. 28 ‚Äî Puntualidad.</strong> Se llega con el margen que diga el m√°s precavido. En transporte no se jode.</div>
          <div class="articulo"><strong>Art. 29 ‚Äî Equipaje.</strong> Cada uno es responsable de sus cosas.</div>
          <div class="articulo"><strong>Art. 30 ‚Äî Documentaci√≥n.</strong> Cada uno lleva sus documentos. El otro tiene foto de DNI por emergencia.</div>
          <div class="articulo"><strong>Art. 31 ‚Äî Salud.</strong> Si uno se siente mal, el otro lo cuida sin quejas ni "te dije". Primero cuidar, despu√©s opinar.</div>
        </div>
      </div>

      <div class="pacto-chapter">
        <div class="chapter-title" onclick="this.parentElement.classList.toggle('open')">
          <span>Cap. 8 ‚Äî Diversi√≥n</span>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="chapter-body">
          <div class="articulo"><strong>Art. 32 ‚Äî Regla de oro.</strong> El objetivo del viaje es <strong>pasarla bien juntos</strong>. Cuando est√©n por pelear, recordar que eligieron estar ah√≠ juntos.</div>
          <div class="articulo"><strong>Art. 33 ‚Äî Una cosa nueva por d√≠a.</strong> Probar comida rara, entrar a un lugar random, hablar con un desconocido.</div>
          <div class="articulo"><strong>Art. 34 ‚Äî Celebrar lo bueno.</strong> "La pas√© muy bien hoy" vale m√°s que cualquier regalo.</div>
        </div>
      </div>

      <div class="pacto-intro" style="margin-top:16px; text-align:center;">
        <em>"Viajamos juntos porque nos elegimos. Que este viaje nos sume, no nos reste."</em>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active" onclick="switchTab('Gestos')"><span class="icon">üìù</span>Cargar</div>
    <div class="tab" onclick="switchTab('Review')"><span class="icon">üîç</span>Revisar</div>
    <div class="tab" onclick="switchTab('Canjes')"><span class="icon">üéÅ</span>Canjes</div>
    <div class="tab" onclick="switchTab('History')"><span class="icon">üìä</span>Historial</div>
    <div class="tab" onclick="switchTab('Reglas')"><span class="icon">üìú</span>Pacto</div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
let currentUser = localStorage.getItem('pacto-user');
let config = { gestos: [], canjes: [] };

async function init() {
  const res = await fetch('/api/config');
  config = await res.json();
  if (currentUser) showApp();
}

function login(user) {
  currentUser = user;
  localStorage.setItem('pacto-user', user);
  showApp();
}

function logout() {
  currentUser = null;
  localStorage.removeItem('pacto-user');
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('app').style.display = 'none';
}

function showApp() {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  const names = { marcos: 'üèîÔ∏è Marcos', sofi: 'üå∏ Sof√≠a' };
  const otherNames = { marcos: 'Sof√≠a', sofi: 'Marcos' };
  document.getElementById('userInfo').textContent = names[currentUser];
  document.getElementById('otherLabel').textContent = otherNames[currentUser];
  renderGestos();
  refresh();
}

function renderGestos() {
  const el = document.getElementById('gestosList');
  el.innerHTML = config.gestos.map(g => `
    <div class="gesto-item" onclick="addGesto('${g.id}')">
      <span class="name">${g.name}</span>
      <span class="pts-badge">+${g.points}</span>
    </div>
  `).join('');
}

async function refresh() {
  const res = await fetch(`/api/status?user=${currentUser}`);
  const d = await res.json();
  
  document.getElementById('myPts').textContent = d.myPoints;
  document.getElementById('otherPts').textContent = d.otherPoints;
  
  const banner = document.getElementById('reviewBanner');
  banner.classList.toggle('active', d.review);
  
  // My pending
  const mp = document.getElementById('myPendingList');
  mp.innerHTML = d.myPending.length ? d.myPending.map(g => `
    <div class="pending-item">
      <span>${g.gestoName}</span>
      <span class="status status-pending">‚è≥ +${g.points}</span>
    </div>
  `).join('') : '<div class="empty-msg">No ten√©s gestos pendientes</div>';
  
  // Review
  const rl = document.getElementById('reviewList');
  if (d.review && d.toReview.length) {
    rl.innerHTML = d.toReview.map(g => `
      <div class="review-item">
        <span class="name">${g.gestoName} (+${g.points})</span>
        <div class="meta">Cargado: ${new Date(g.timestamp).toLocaleString('es-AR')}</div>
        <div class="review-actions">
          <button class="btn-approve" onclick="reviewGesto(${g.id},'approve')">‚úÖ Aprobar</button>
          <button class="btn-reject" onclick="reviewGesto(${g.id},'reject')">‚ùå Rechazar</button>
        </div>
      </div>
    `).join('');
  } else if (d.review) {
    rl.innerHTML = '<div class="empty-msg">No hay gestos para revisar üéâ</div>';
  } else {
    rl.innerHTML = '<div class="empty-msg">‚è∞ Revisi√≥n disponible a las 10am, 4pm y 10pm</div>';
  }
  
  // Canjes
  const cl = document.getElementById('canjesList');
  cl.innerHTML = config.canjes.map(c => `
    <div class="canje-item" onclick="addCanje('${c.id}')">
      <span class="name">${c.name}</span>
      <span class="cost-badge">${c.cost}‚≠ê</span>
    </div>
  `).join('');
  
  // Pending canjes from other
  const pcl = document.getElementById('pendingCanjesList');
  pcl.innerHTML = d.pendingCanjes.length ? d.pendingCanjes.map(c => `
    <div class="review-item">
      <span class="name">${c.canjeName} (${c.cost}‚≠ê)</span>
      <div class="review-actions">
        <button class="btn-approve" onclick="reviewCanje(${c.id},'approve')">‚úÖ Aprobar</button>
        <button class="btn-reject" onclick="reviewCanje(${c.id},'reject')">‚ùå Rechazar</button>
      </div>
    </div>
  `).join('') : '<div class="empty-msg">Sin canjes pendientes</div>';
  
  // My canjes
  const mcl = document.getElementById('myCanjesList');
  mcl.innerHTML = d.myCanjes.length ? d.myCanjes.map(c => `
    <div class="pending-item">
      <span>${c.canjeName}</span>
      <span class="status status-${c.status}">${c.status === 'pending' ? '‚è≥' : c.status === 'approved' ? '‚úÖ' : '‚ùå'} ${c.cost}‚≠ê</span>
    </div>
  `).join('') : '<div class="empty-msg">No canjeaste nada a√∫n</div>';
  
  // History
  const hl = document.getElementById('historyList');
  const histItems = d.history.reverse();
  hl.innerHTML = histItems.length ? histItems.map(g => `
    <div class="pending-item">
      <span>${g.user === currentUser ? 'üôã' : 'üë§'} ${g.gestoName}</span>
      <span class="status status-${g.status}">${g.status === 'approved' ? '‚úÖ' : g.status === 'disputed' ? '‚ö†Ô∏è Sirius' : '‚ùå'} ${g.points}pts</span>
    </div>
  `).join('') : '<div class="empty-msg">Sin historial a√∫n</div>';
}

function switchTab(name) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById('sec' + name).classList.add('active');
  event.currentTarget.classList.add('active');
  refresh();
}

async function addGesto(gestoId) {
  const res = await fetch('/api/gesto', {
    method: 'POST', headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ user: currentUser, gestoId })
  });
  if (res.ok) { toast('¬°Gesto registrado! ‚ú®'); refresh(); }
}

async function reviewGesto(id, action) {
  const res = await fetch('/api/review', {
    method: 'POST', headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ user: currentUser, gestoDbId: id, action })
  });
  if (res.ok) { toast(action === 'approve' ? '‚úÖ Aprobado!' : '‚ö†Ô∏è Enviado a Sirius'); refresh(); }
}

async function addCanje(canjeId) {
  const res = await fetch('/api/canje', {
    method: 'POST', headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ user: currentUser, canjeId })
  });
  const data = await res.json();
  if (res.ok) { toast('¬°Canje solicitado! üéÅ'); refresh(); }
  else { toast(data.error || 'Error'); }
}

async function reviewCanje(id, action) {
  const res = await fetch('/api/canje-review', {
    method: 'POST', headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ user: currentUser, canjeDbId: id, action })
  });
  if (res.ok) { toast(action === 'approve' ? '‚úÖ Canje aprobado!' : '‚ùå Canje rechazado'); refresh(); }
}

function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

// Auto-refresh every 30s
setInterval(refresh, 30000);
init();
</script>
</body>
</html>
